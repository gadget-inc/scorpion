<% content_for(:title, "Dashboard") %>

<%= render layout: "layout" do %>
<%= begin
      dashboard = @dashboard
      get_header = Proc.new do |run|
        content_tag(:div) do
          concat admin_link_to(run.name, run)
          concat content_tag(:div, autoformat_value(run.created_at))
        end
      end
      table collection: @dashboard.property_rows, admin: :dashboard do
        column(:property) { |row| row[:property] }
        column(:customizations) do |row|
          customizations = row[:property].internal_test_options.try(:keys) || []
          safe_join customizations.map { |name| content_tag(:span, name, class: "badge badge-light") }
        end
    
        dashboard.runs.each_with_index do |run|
          header = get_header.call(run)
          column(run.name, header: header) do |property_row|
            test_case = property_row[:cases][run.id]
            if test_case
              admin_link_to(outcome_tag(test_case.successful), test_case)
            else
              content_tag(:span, "not run", class: "blank")
            end
          end
        end
      end
    end %>
<% end %>